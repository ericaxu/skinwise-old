@(state: src.controllers.util.ResponseState, product: src.models.data.Product)

@template(product.getBrand.getName + " " + product.getName + " - Skin Wise", state) {

} {

<div class="product_detail">
    <div class="picture">
        @if(product.getImage.length > 0) {
            <img src="@product.getImage" alt="@product.getBrandName @product.getName"/>
        } else {
            <img src="@routes.Assets.at("/public", "images/placeholder.png")" alt="No Image Available"/>
        }
    </div>

    <div class="ingredient_container">
        <h1 class="name">@product.getName</h1>
        <h3 class="brand">by <a href="/brand/@product.getBrand.getId">@product.getBrandName</a></h3>
        @if(product.hasDescription) {
            <div class="claim">
                <h3>What It Does</h3>
                <p>@product.getDescription</p>
            </div>
        }

        @if(!product.getKey_ingredients.isEmpty) {
            <div class="active_ingredients">
                <h3>Key Ingredients</h3>
                @defining(product.getKey_ingredients) { key =>
                    <p>@for(i <- 0 to key.size-2) {
                        @if(key(i).getIngredient != null) {
                            @defining(key(i).getIngredient.getId) { id =>
                                <a href="/ingredient/@id"><span class="ingredient" data-id="@id">@key(i).getDisplayName</span></a>,
                            }
                        } else {
                            <span class="ingredient unrecognized">@key(i).getDisplayName</span>,
                        }
                    }

                    @if(key(key.size-1).getIngredient != null) {
                        @defining(key(key.size-1).getIngredient.getId) { id =>
                            <a href="/ingredient/@id"><span class="ingredient" data-id="@id">@key(key.size - 1).getDisplayName</span></a>
                        }
                    } else {
                        <span class="ingredient unrecognized">@key(key.size-1).getDisplayName</span>
                    }
                    </p>
                }
            </div>

            @if(!product.getIngredients.isEmpty) {
                <div class="other_ingredients">
                    <h3>Other Ingredients</h3>
            }
        } else {
            @if(!product.getIngredients.isEmpty) {
                <div class="ingredients">
                    <h3>Ingredients</h3>
            }
        }

        @if(!product.getIngredients.isEmpty) {
            @defining(product.getIngredients) { ing =>
                <p>@for(i <- 0 to ing.size-2) {
                    @if(ing(i).getIngredient != null) {
                        @defining(ing(i).getIngredient.getId) { id =>
                            <a href="/ingredient/@id"><span class="ingredient" data-id="@id">@ing(i).getDisplayName</span></a>,
                        }
                    } else {
                        <span class="ingredient unrecognized">@ing(i).getDisplayName</span>,
                    }
                }

                @if(ing(ing.size-1).getIngredient != null) {
                    @defining(ing(ing.size-1).getIngredient.getId) { id =>
                        <a href="/ingredient/@id"><span class="ingredient" data-id="@id">@ing(ing.size - 1).getDisplayName</span></a>
                    }
                } else {
                    <span class="ingredient unrecognized">@ing(ing.size-1).getDisplayName</span>
                }
                </p>
            }
        }
        </div>
    </div>
</div>

} {

<script>
    checkImage($('.picture img'), '@product.getImage');
    postToAPI('/product/ingredientinfo', {
        id: @product.getId
    }, getIngredientInfoSuccess);
</script>

}
